# RoadExpeditionerDrone

**RoadExpeditionerDrone** is a fully containerized **ROS 2** + **Gazebo** project that builds a
fully autonomous drone perform mapping, localization, exploration and planning. 

## Algorithm Overview

- **Simultaneous Localization and Mapping (RTAB-Map)**: Provides globally consistent mapping and
  loop closure using RGB-D data to correct for odometry drift.

- **Visual Inertial Odometry (OpenVINS)**: Estimates local continuous odometry at high frequency
  using camera and IMU data.

- **Trajectory Planning (Minimum Snap Algorithm)**: Generates smooth, continuous polynomial
  trajectories between waypoints.

- **Path Planning (Nav2)**: Computes optimal, collision-free global and local paths navigating
  through the generated map.

- **Map Exploration (Frontier Detection)**: Identifies boundaries between known free space and
  unknown areas to dynamically guide autonomous exploration.

- **Geometric SE(3) Controller**: A low-level nonlinear tracking controller by T. Lee et al. that
  publishes motor speed commands to accurately follow desired trajectories.

## Architecture

The repository includes six in-house ROS packages under `src/`:
```
src/
  red_bringup/
  red_geometric_controller/
  red_gz_plugin/
  red_navigator/
  red_perception/
  red_vio_estimator/
```

- **`red_bringup`**: The main entry point. Orchestrates the ROS 2 nodes and launches the Gazebo
  simulation environment.

- **`red_geometric_controller`**: Runs the low-level SE(3) geometric controller, publishing motor
  speed commands at 100 Hz to follow planned trajectories.

- **`red_gz_plugin`**: Custom Gazebo plugins bridging simulated quadrotors with ROS 2. It publishes
  sensor data (IMU at 250 Hz, RGB-D at 30 Hz) and subscribes to motor speeds.

- **`red_navigator`**: High-level navigation state machine. Combines frontier exploration, Nav2 path
  planning, and trajectory generation to output desired tracking poses at 5 Hz.

- **`red_perception`**: Handles RGB-D sensor streams and runs RTAB-Map for 3D mapping and loop
  closure.

- **`red_vio_estimator`**: Wraps OpenVINS to compute high-frequency visual-inertial odometry for
  local continuous state estimation.

## Coordinate Frames

Following standard ROS conventions (REP-105), the project utilizes a frame tree to manage coordinate
transformations.

- **world**: The absolute, globally fixed coordinate system in the Gazebo simulation. Simulated
  ground truth positional data is expressed relative to this frame.

- **map**: A globally consistent, world-fixed frame generated by RTAB-Map. Unlike `odom`, the `map`
  frame can experience discrete, instantaneous jumps when RTAB-Map performs loop closures to correct
  accumulated long-term odometry drift. It is useful for global path planning and SLAM.

- **odom**: A local, continuous, and world-fixed frame estimated by the VIO system (OpenVINS). Its
  pose will drift over time compared to `map`, but it guarantees continuity (no discrete jumps),
  making it suitable for smooth, short-term local trajectory tracking and low-level motor control.
  By convention, this frame initializes at `(0, 0, 0)` when the VIO system starts.

- **base_link**: The robot's primary body frame, rigidly attached to the drone's center of mass or
  flight controller. All onboard sensors (IMU, cameras) publish data relative to this frame or its
  static child frames (e.g., `camera_link`).

## How to run

1. Initialize git submodule OpenVINS at `src/open_vins`: After cloning this repository, initialize
   submodules before building:
    ```bash
    git submodule update --init --recursive
    ```

2. Activate Environment: Open IDE and run "Dev Containers: Rebuild and Reopen in Container".

3. Build the workspace and launch
    ```bash
    rm -rf build install log ~/.ros/rtabmap.db \
    && source /opt/ros/humble/setup.bash \
    && colcon build --base-paths src --symlink-install --cmake-args -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
    && source install/setup.bash \
    && ros2 launch red_bringup simulation.launch.py world_path:=src/red_bringup/worlds/single_layer_maze.world world_name:=single_layer_maze_world
    ```

---

## References
Materials used during development and recommended reading.

### ROS 2 Humble and Gazebo Harmonic
- [ROS 2 Humble Documentation](https://docs.ros.org/en/humble/)
- [Gazebo Harmonic Documentation](https://gazebosim.org/docs/harmonic/getstarted/)

### RTAM-Map

### Nav2

### OpenVINS

### PX4
- [Hands-On Aerial Robotics Using PX4 and ROS 2](https://github.com/Dronecode/roscon-25-workshop)
