# Container-based Development

## Coordinate Frames

Following standard ROS conventions (REP-105), the project utilizes a frame tree to manage coordinate
transformations.

- **world**: The absolute, globally fixed coordinate system in the Gazebo simulation. Simulated
  ground truth positional data is expressed relative to this frame.

- **map**: A globally consistent, world-fixed frame generated by RTAB-Map. Unlike `odom`, the `map`
  frame can experience discrete, instantaneous jumps when RTAB-Map performs loop closures to correct
  accumulated long-term odometry drift. It is useful for global path planning and SLAM.

- **odom**: A local, continuous, and world-fixed frame estimated by the VIO system (OpenVINS). Its
  pose will drift over time compared to `map`, but it guarantees continuity (no discrete jumps),
  making it suitable for smooth, short-term local trajectory tracking and low-level motor control.
  By convention, this frame initializes at `(0, 0, 0)` when the VIO system starts.

- **base_link**: The robot's primary body frame, rigidly attached to the drone's center of mass or
  flight controller. All onboard sensors (IMU, cameras) publish data relative to this frame or its
  static child frames (e.g., `camera_link`).

## Useful Commands

- Visualize nodes, topics, services
```
rqt_graph
```

- List all ROS topics:
```
~/RoadExpeditionerDrone$ ros2 topic list
/clicked_point
/clock
/diagnostics
/drone_1/apriltag/detections
/drone_1/aruco/detections
/drone_1/aruco_opencv/detections
/drone_1/bond
/drone_1/cloud_ground
/drone_1/cloud_map
/drone_1/cloud_obstacles
/drone_1/command/motor_speed
/drone_1/depth/camera_info
/drone_1/depth/image
/drone_1/desired_odometry
/drone_1/global_costmap/costmap
/drone_1/global_costmap/costmap_raw
/drone_1/global_costmap/costmap_updates
/drone_1/global_costmap/footprint
/drone_1/global_costmap/global_costmap/transition_event
/drone_1/global_costmap/published_footprint
/drone_1/global_path
/drone_1/global_path_nodes
/drone_1/global_pose
/drone_1/goal
/drone_1/goal_node
/drone_1/goal_out
/drone_1/goal_reached
/drone_1/gps/fix
/drone_1/grid_prob_map
/drone_1/groundtruth_odometry
/drone_1/imu
/drone_1/info
/drone_1/initialpose
/drone_1/labels
/drone_1/landmark_detection
/drone_1/landmark_detections
/drone_1/landmarks
/drone_1/local_grid_empty
/drone_1/local_grid_ground
/drone_1/local_grid_obstacle
/drone_1/local_path
/drone_1/local_path_nodes
/drone_1/localization_pose
/drone_1/loop_depth
/drone_1/loop_depth/compressed
/drone_1/loop_depth/compressedDepth
/drone_1/loop_depth/theora
/drone_1/loop_depth_colored
/drone_1/loop_depth_colored/compressed
/drone_1/loop_depth_colored/compressedDepth
/drone_1/loop_depth_colored/theora
/drone_1/loop_extrinsic
/drone_1/loop_feats
/drone_1/loop_intrinsics
/drone_1/loop_pose
/drone_1/map
/drone_1/mapData
/drone_1/mapGraph
/drone_1/mapOdomCache
/drone_1/mapPath
/drone_1/map_updates
/drone_1/octomap_binary
/drone_1/octomap_empty_space
/drone_1/octomap_full
/drone_1/octomap_global_frontier_space
/drone_1/octomap_grid
/drone_1/octomap_ground
/drone_1/octomap_obstacles
/drone_1/octomap_occupied_space
/drone_1/odometry
/drone_1/odomimu
/drone_1/pathgt
/drone_1/pathimu
/drone_1/plan
/drone_1/planner_server/transition_event
/drone_1/points_aruco
/drone_1/points_msckf
/drone_1/points_sim
/drone_1/points_slam
/drone_1/posegt
/drone_1/poseimu
/drone_1/rgb/camera_info
/drone_1/rgb/image
/drone_1/rtabmap/republish_node_data
/drone_1/tag_detections
/drone_1/trackhist
/drone_1/trackhist/compressed
/drone_1/trackhist/compressedDepth
/drone_1/trackhist/theora
/drone_1/unsmoothed_plan
/drone_1/user_data_async
/drone_1/visual_path
/initialpose
/move_base_simple/goal
/parameter_events
/rosout
/tf
/tf_static
```

- List all ROS nodes:
```
~/RoadExpeditionerDrone$ ros2 node list
/drone_1/depth_bridge
/drone_1/flight_interface
/drone_1/geometric_controller_node
/drone_1/global_costmap/global_costmap
/drone_1/imu_bridge
/drone_1/lifecycle_manager_navigation
/drone_1/navigator_node
/drone_1/odom_adapter
/drone_1/odometry_groundtruth_bridge
/drone_1/openvins
/drone_1/planner_server
/drone_1/rgb_bridge
/drone_1/rtabmap
/drone_1/rviz2
/drone_1/static_tf_base_link_to_StereoOV7251
/drone_1/static_tf_base_link_to_camera_link
/drone_1/static_tf_base_link_to_imu_sensor
/drone_1/static_tf_base_link_to_imx214
/drone_1/transform_listener_impl_55e163ea3220
/drone_1/transform_listener_impl_56a3497839a0
/drone_1/transform_listener_impl_58208091ee00
/drone_1/transform_listener_impl_650ded189030
/ros_gz_bridge_clock
```

- List all ROS transforms:
```
# save to frames_*.gv
~/RoadExpeditionerDrone$ ros2 run tf2_tools view_frames
```

- Get frequency of a ROS topic:
```
~/RoadExpeditionerDrone$ ros2 topic hz /drone_1/odometry
average rate: 162.661
        min: 0.002s max: 0.174s std dev: 0.01471s window: 164
average rate: 196.888
        min: 0.001s max: 0.174s std dev: 0.00957s window: 396
average rate: 199.207
        min: 0.001s max: 0.174s std dev: 0.00841s window: 600
```

- List all Gazebo topics:
```
~/RoadExpeditionerDrone$ gz topic -l
/clock
/drone_1/command/motor_speed
/gazebo/resource_paths
/gui/camera/pose
/gui/currently_tracked
/gui/track
/model/drone_1/odometry
/model/drone_1/odometry_with_covariance
/model/drone_1/pose
/sensors/marker
/stats
/world/single_layer_maze_world/clock
/world/single_layer_maze_world/dynamic_pose/info
/world/single_layer_maze_world/model/drone_1/link/base_link/sensor/imu_sensor/imu
/world/single_layer_maze_world/model/drone_1/link/base_link/sensor/navsat_sensor/navsat
/world/single_layer_maze_world/model/drone_1/link/camera_link/sensor/IMX214/camera_info
/world/single_layer_maze_world/model/drone_1/link/camera_link/sensor/IMX214/image
/world/single_layer_maze_world/model/drone_1/link/camera_link/sensor/StereoOV7251/camera_info
/world/single_layer_maze_world/model/drone_1/link/camera_link/sensor/StereoOV7251/depth_image
/world/single_layer_maze_world/model/drone_1/link/camera_link/sensor/StereoOV7251/depth_image/points
/world/single_layer_maze_world/pose/info
/world/single_layer_maze_world/scene/deletion
/world/single_layer_maze_world/scene/info
/world/single_layer_maze_world/state
/world/single_layer_maze_world/stats
/world/single_layer_maze_world/light_config
/world/single_layer_maze_world/material_color
```
